class DocTool{constructor(a,b=true){this.a=document.getElementById(a);this.b=$("#"+a).addClass(["docContainer","docPageA4","docPagePaddingNormal"]).empty();this.c="A4";this.ba="Normal";this.d={width:792,height:1120,paddingTop:94,paddingRight:118,paddingBottom:94,paddingLeft:118};this.e="";this.f="";this.g="";this.h="";this.i="";this.j="";this.k="";this.bb="";this.l="";this.m="";this.n="";this.o="";this.p="";this.q="";this.r={};this.s="";this.t="";this.u="";this.v="";this.w="";this.x="";this.y="";this.z={};this.aa="";this.ab="";this.ac="";this.ad="";this.ae="";this.af="";this.ag="";this.ah={};this.ai="";this.aj="";this.ak="";this.al="";this.am="";this.an="";this.ao="";this.ap={};this.aq="";this.ar="";this.as="";this.at="";this.au="";this.av="";this.aw="";this.ax={};this.ay=false;this.az=[];if(b)this.addPage()}addPage(){let a=$("<article></article>").css("width",this.e).css("height",this.f).css("padding-top",this.g).css("padding-right",this.h).css("padding-bottom",this.i).css("padding-left",this.j);this.b.append(a);return a}changePageSize(a="A4"){if(a==="")a="A4";this.b.removeClass(`docPage${this.c}`).addClass(`docPage${a}`);this.c=a}changePagePadding(a="Normal"){if(a==="")a="Normal";this.b.removeClass(`docPagePadding${this.ba}`).addClass(`docPagePadding${a}`);this.ba=a}setPageBackgroundColor(a=""){this.b.children("article").css("background-color",a);this.bb=a}clearPageBackgroundColor(){this.setPageBackgroundColor()}deleteFirstPage(){this.b.children("article:first-child").remove()}deleteLastPage(){this.b.children("article:last-child").remove()}deletePage(a){if(a===undefined)this.b.children("article").remove();else this.b.children("article").eq(a).remove()}setPageWidth(a){if(typeof a==="number")a+="px";if(Number.isNaN(parseFloat(a)))return;this.e=a}setPageHeight(a){if(typeof a==="number")a+="px";if(Number.isNaN(a))return;this.f=a}setPagePaddingTop(a){if(typeof a==="number")a+="px";if(Number.isNaN(a))return;this.g=a}setPagePaddingRight(a){if(typeof a==="number")a+="px";if(Number.isNaN(a))return;this.h=a}setPagePaddingBottom(a){if(typeof a==="number")a+="px";if(Number.isNaN(a))return;this.i=a}setPagePaddingLeft(a){if(typeof a==="number")a+="px";if(Number.isNaN(a))return;this.j=a}setTitleFontSize(a){this.n=a;this.b.find(".docTitle").css("font-size",a)}setTitleFontWeight(a){this.o=a;this.b.find(".docTitle").css("font-weight",a)}setTitleFontColor(a){this.p=a;this.b.find(".docTitle").css("font-color",a)}setTitleTextAlign(a){this.q=a;this.b.find(".docTitle").css("text-align",a)}setTitleLineHeight(a){this.k=a;this.b.find(".docTitle").css("line-height",a)}setTitleParagraphPaddingTop(a){this.l=a;this.b.find(".docTitle").css("padding-top",a)}setTitleParagraphPaddingBottom(a){this.m=a;this.b.find(".docTitle").css("padding-bottom",a)}setTitleStyle(a){a=JSON.parse(JSON.stringify(a));DocTool.deleteProperties(a,"margin");this.r=a;this.b.find(".docTitle").css(a)}clearTitleStyle(){this.r={};this.b.find(".docTitle").removeAttr("style")}clearTitleStyleSetting(){this.r={}}createTitle(text,style={}){if(this.ay){this.az[this.az.length]={method:this.createTitle,argArray:Array.from(arguments)}}else{this.ay=true;setTimeout(()=>{this.__createTitle(text,style);this.ay=false;this.__continueWork()})}}__createTitle(text,style={}){DocTool.deleteProperties(style,"margin");this.__addText({text,className:"docTitle",fn:this.__createTitle},$new=>{if(Object.keys(this.r).length===0){$new.css("font-size",this.n).css("font-weight",this.o).css("font-color",this.p).css("text-align",this.q).css("line-height",this.k).css("padding-top",this.l).css("padding-bottom",this.m)}else{$new.css(this.r)}$new.css(style)})}setSubTitleFontSize(a){this.v=a;this.b.find(".docSubTitle").css("font-size",a)}setSubTitleFontWeight(a){this.w=a;this.b.find(".docSubTitle").css("font-weight",a)}setSubTitleFontColor(a){this.x=a;this.b.find(".docSubTitle").css("font-color",a)}setSubTitleTextAlign(a){this.y=a;this.b.find(".docSubTitle").css("text-align",a)}setSubTitleLineHeight(a){this.s=a;this.b.find(".docSubTitle").css("line-height",a)}setSubTitleParagraphPaddingTop(a){this.t=a;this.b.find(".docSubTitle").css("padding-top",a)}setSubTitleParagraphPaddingBottom(a){this.u=a;this.b.find(".docSubTitle").css("padding-bottom",a)}setSubTitleStyle(a){a=JSON.parse(JSON.stringify(a));DocTool.deleteProperties(a,"margin");this.z=a;this.b.find(".docSubTitle").css(a)}clearSubTitleStyle(){this.z={};this.b.find(".docSubTitle").removeAttr("style")}clearSubTitleStyleSetting(){this.z={}}createSubTitle(text,style={}){if(this.ay){this.az[this.az.length]={method:this.createSubTitle,argArray:Array.from(arguments)}}else{this.ay=true;setTimeout(()=>{this.__createSubTitle(text,style);this.ay=false;this.__continueWork()})}}__createSubTitle(text,style={}){DocTool.deleteProperties(style,"margin");this.__addText({text,className:"docSubTitle",fn:this.__createSubTitle},$new=>{if(Object.keys(this.z).length===0){$new.css("font-size",this.v).css("font-weight",this.w).css("font-color",this.x).css("text-align",this.y).css("line-height",this.s).css("padding-top",this.t).css("padding-bottom",this.u)}else{$new.css(this.z)}$new.css(style)})}setH1FontSize(a){this.ad=a;this.b.find(".docH1").css("font-size",a)}setH1FontWeight(a){this.ae=a;this.b.find(".docH1").css("font-weight",a)}setH1FontColor(a){this.af=a;this.b.find(".docH1").css("font-color",a)}setH1TextAlign(a){this.ag=a;this.b.find(".docH1").css("text-align",a)}setH1LineHeight(a){this.aa=a;this.b.find(".docH1").css("line-height",a)}setH1ParagraphPaddingTop(a){this.ab=a;this.b.find(".docH1").css("padding-top",a)}setH1ParagraphPaddingBottom(a){this.ac=a;this.b.find(".docH1").css("padding-bottom",a)}setH1Style(a){a=JSON.parse(JSON.stringify(a));DocTool.deleteProperties(a,"margin");this.ah=a;this.b.find(".docH1").css(a)}clearH1Style(){this.ah={};this.b.find(".docH1").removeAttr("style")}clearH1StyleSetting(){this.ah={}}createH1(text,style={}){if(this.ay){this.az[this.az.length]={method:this.createH1,argArray:Array.from(arguments)}}else{this.ay=true;setTimeout(()=>{this.__createH1(text,style);this.ay=false;this.__continueWork()})}}__createH1(text,style={}){DocTool.deleteProperties(style,"margin");this.__addText({text,className:"docH1",fn:this.__createH1},$new=>{if(Object.keys(this.ah).length===0){$new.css("font-size",this.ad).css("font-weight",this.ae).css("font-color",this.af).css("text-align",this.ag).css("line-height",this.aa).css("padding-top",this.ab).css("padding-bottom",this.ac)}else{$new.css(this.ah)}$new.css(style)})}setH2FontSize(a){this.al=a;this.b.find(".docH2").css("font-size",a)}setH2FontWeight(a){this.am=a;this.b.find(".docH2").css("font-weight",a)}setH2FontColor(a){this.an=a;this.b.find(".docH2").css("font-color",a)}setH2TextAlign(a){this.ao=a;this.b.find(".docH2").css("text-align",a)}setH2LineHeight(a){this.ai=a;this.b.find(".docH2").css("line-height",a)}setH2ParagraphPaddingTop(a){this.aj=a;this.b.find(".docH2").css("padding-top",a)}setH2ParagraphPaddingBottom(a){this.ak=a;this.b.find(".docH2").css("padding-bottom",a)}setH2Style(a){a=JSON.parse(JSON.stringify(a));DocTool.deleteProperties(a,"margin");this.ap=a;this.b.find(".docH2").css("style",a)}clearH2Style(){this.ap={};this.b.find(".docH2").removeAttr("style")}clearH2StyleSetting(){this.ap={}}createH2(text,style={}){if(this.ay){this.az[this.az.length]={method:this.createH2,argArray:Array.from(arguments)}}else{this.ay=true;setTimeout(()=>{this.__createH2(text,style);this.ay=false;this.__continueWork()})}}__createH2(text,style={}){DocTool.deleteProperties(style,"margin");this.__addText({text,className:"docH2",fn:this.__createH2},$new=>{if(Object.keys(this.ap).length===0){$new.css("font-size",this.al).css("font-weight",this.am).css("font-color",this.an).css("text-align",this.ao).css("line-height",this.ai).css("padding-top",this.aj).css("padding-bottom",this.ak)}else{$new.css(this.ap)}$new.css(style)})}setTextFontSize(a){this.at=a;this.b.find(".docText").css("font-size",a)}setTextFontWeight(a){this.au=a;this.b.find(".docText").css("font-weight",a)}setTextFontColor(a){this.av=a;this.b.find(".docText").css("font-color",a)}setTextTextAlign(a){this.aw=a;this.b.find(".docText").css("text-align",a)}setTextLineHeight(a){this.aq=a;this.b.find(".docText").css("line-height",a)}setTextParagraphPaddingTop(a){this.ar=a;this.b.find(".docText").css("padding-top",a)}setTextParagraphPaddingBottom(a){this.as=a;this.b.find(".docText").css("padding-bottom",a)}setTextStyle(a){a=JSON.parse(JSON.stringify(a));DocTool.deleteProperties(a,"margin");this.ax=a;this.b.find(".docText").css(a)}clearTextStyle(){this.ax={};this.b.find(".docText").removeAttr("style")}clearTextStyleSetting(){this.ax={}}createText(title,text){if(this.ay){this.az[this.az.length]={method:this.createText,argArray:Array.from(arguments)}}else{this.ay=true;setTimeout(()=>{this.__createText(title,text);this.ay=false;this.__continueWork()})}}__createText(title,text){if(text===undefined){text=title;title=undefined}this.__addText({title,text,className:"docText",fn:this.__createText},$new=>{if(Object.keys(this.ax).length===0){$new.css("font-size",this.at).css("font-weight",this.au).css("font-color",this.av).css("text-align",this.aw).css("line-height",this.aq).css("padding-top",this.ar).css("padding-bottom",this.as)}else{$new.css(this.ax)}})}createCustomText(text,className="",style={}){if(this.ay){this.az[this.az.length]={method:this.createCustomText,argArray:Array.from(arguments)}}else{this.ay=true;setTimeout(()=>{this.__createCustomText(text,className,style);this.ay=false;this.__continueWork()})}}__createCustomText(text,className,style){DocTool.deleteProperties(style,"margin");if(Array.isArray(className))className=className.join(" ");this.__addText({text,className,fn:this.createCustomText},$new=>$new.css(style))}createImgInLineWithBase64(base64,obj={type:"png"}){if(this.ay){this.az[this.az.length]={method:this.createImgInLineWithBase64,argArray:Array.from(arguments)}}else{this.ay=true;if(typeof obj!=="object"||obj===null)obj={type:"png"};let article=this.__getLastPage();let h=DocTool.getContentHeight(article);if(!base64.startsWith("data:image/"))base64=`data:image/${typeof obj.type==="string"?obj.type:"png"};base64,${base64}`;let $new=$(`<div class="docImg"${typeof obj.align==="string"?`style="text-align: ${obj.align}"`:""}><img src="${base64}"title="${typeof obj.title === "string" ? obj.title : ""}"alt="${typeof obj.alt === "string" ? obj.alt : ""}"></div>`);if(typeof obj.style==="object"&&obj.style!==null){let style=JSON.parse(JSON.stringify(obj.style));DocTool.deleteProperties(style,"float");$new.css(style)}article.append($new);setTimeout(()=>{if(h+$new.outerHeight()>this.__getPageHeightLimit()){this.addPage().append($new)}this.ay=false;this.__continueWork()})}}createImgFloatWithBase64(base64,obj={type:"png",float:"right"}){if(this.ay){this.az[this.az.length]={method:this.createImgFloatWithBase64,argArray:Array.from(arguments)}}else{this.ay=true;if(typeof obj!=="object"||obj===null)obj={type:"png",float:"right"};let article=this.__getLastPage();let h=DocTool.getContentHeight(article);if(!base64.startsWith("data:image/"))base64=`data:image/${typeof obj.type==="string"?obj.type:"png"};base64,${base64}`;let $new=$(`<div style="float: ${typeof obj.float === "string" ? obj.float : "right"};"><img src="${base64}"title="${typeof obj.title === "string" ? obj.title : ""}"alt="${typeof obj.alt === "string" ? obj.alt : ""}"></div>`);if(typeof obj.style==="object"&&obj.style!==null){let style=JSON.parse(JSON.stringify(obj.style));DocTool.deleteProperties(style,"float");$new.css(style)}article.append($new);setTimeout(()=>{if(h+$new.outerHeight()>this.__getPageHeightLimit()){this.addPage().append($new)}this.ay=false;this.__continueWork()})}}createImgInLineWithPath(path,obj={}){if(this.ay){this.az[this.az.length]={method:this.createImgInLineWithPath,argArray:Array.from(arguments)}}else{this.ay=true;if(typeof obj!=="object"||obj===null)obj={};let article=this.__getLastPage();let h=DocTool.getContentHeight(article);let $new=$(`<div class="docImg"${typeof obj.align==="string"?`style="text-align: ${obj.align}"`:""}><img src="${path}"title="${typeof obj.title === "string" ? obj.title : ""}"alt="${typeof obj.alt === "string" ? obj.alt : ""}"></div>`);if(typeof obj.style==="object"&&obj.style!==null){let style=JSON.parse(JSON.stringify(obj.style));DocTool.deleteProperties(style,"float");$new.css(style)}article.append($new);setTimeout(()=>{if(h+$new.outerHeight()>this.__getPageHeightLimit()){this.addPage().append($new)}this.ay=false;this.__continueWork()})}}createImgFloatWithPath(path,obj={float:"right"}){if(this.ay){this.az[this.az.length]={method:this.createImgFloatWithPath,argArray:Array.from(arguments)}}else{this.ay=true;if(typeof obj!=="object"||obj===null)obj={float:"right"};let article=this.__getLastPage();let h=DocTool.getContentHeight(article);let $new=$(`<div style="float: ${typeof obj.float === "string" ? obj.float : "right"};"><img src="${path}"title="${typeof obj.title === "string" ? obj.title : ""}"alt="${typeof obj.alt === "string" ? obj.alt : ""}"></div>`);if(typeof obj.style==="object"&&obj.style!==null){let style=JSON.parse(JSON.stringify(obj.style));DocTool.deleteProperties(style,"float");$new.css(style)}article.append($new);setTimeout(()=>{if(h+$new.outerHeight()>this.__getPageHeightLimit()){this.addPage().append($new)}this.ay=false;this.__continueWork()})}}createTable(table,obj={}){if(this.ay){this.az[this.az.length]={method:this.createTable,argArray:Array.from(arguments)}}else{this.ay=true;setTimeout(()=>{this.__createTable(table,obj);this.ay=false;this.__continueWork()})}}__createTable(table,obj){let defaultProp={className:"docTable",style:{},multipleLine:true,multipleLineSplitSymbolRegExp:"\\n",customCol:[],customColStyle:{},customRow:[],customRowStyle:{},topHeadNum:0,topHeadStyle:{},leftHeadNum:0,leftHeadStyle:{},rightHeadNum:0,rightHeadStyle:{},bottomHeadNum:0,bottomHeadStyle:{},contentStyle:{},contentStyles:[],contentStylesPrivilege:[],};DocTool.shallowCopy(defaultProp,obj);if(Array.isArray(defaultProp.className))defaultProp.className=defaultProp.className.join(" ");else if(typeof defaultProp.className!=="string")defaultProp.className="docTable";if(typeof defaultProp.multipleLineSplitSymbolRegExp!=="string")defaultProp.multipleLineSplitSymbolRegExp="\\n";DocTool.deleteProperties(defaultProp.style,"margin");let $article=this.__getLastPage();let h=DocTool.getContentHeight($article);let pageHeightLimit=this.__getPageHeightLimit();let $new=$(`<table class="${defaultProp.className}"></table>`).css(defaultProp.style);if(Array.isArray(table)){$article.append($new);let regExp=new RegExp(defaultProp.multipleLineSplitSymbolRegExp,"g");let trLength=table.length;table.forEach((tr,i)=>{let $tr=$(`<tr></tr>`);if(Array.isArray(tr)){tr.forEach((td,j)=>{td+="";td=defaultProp.multipleLine?`<div>${td.replace(regExp,"</div><div>")}</div>`:`<div>${td}</div>`;let $td=$(`<td>${td}</td>`).css(defaultProp.contentStyle);if(defaultProp.contentStyles.hasOwnProperty(i)&&defaultProp.contentStyles[i].hasOwnProperty(j)&&typeof defaultProp.contentStyles[i][j]==="object"){$td.css(defaultProp.contentStyles[i][j])}$tr.append($td)});let $tds=$tr.children("td");Array.isArray(defaultProp.customRow)&&defaultProp.customRow.forEach(row=>$tds.eq(row).css(defaultProp.customRowStyle));Array.isArray(defaultProp.customCol)&&defaultProp.customCol.some(col=>col===i&&$tds.css(defaultProp.customColStyle));let tdLength=tr.length-1;for(let j=0;j<defaultProp.rightHeadNum;j++)$tds.eq(tdLength-j).css(defaultProp.rightHeadStyle);defaultProp.bottomHeadNum>=(trLength-i)&&$tds.css(defaultProp.bottomHeadStyle);for(let j=0;j<defaultProp.leftHeadNum;j++)$tds.eq(j).css(defaultProp.leftHeadStyle);defaultProp.topHeadNum>i&&$tds.css(defaultProp.topHeadStyle);$tds.each(function(){let $this=$(this),j=$this.index();if(defaultProp.contentStylesPrivilege.hasOwnProperty(i)&&defaultProp.contentStylesPrivilege[i].hasOwnProperty(j)&&typeof defaultProp.contentStylesPrivilege[i][j]==="object"){$this.css(defaultProp.contentStylesPrivilege[i][j])}})}$new.append($tr);if($new.outerHeight()+h>pageHeightLimit){if(i===0){$article=this.addPage().append($new)}else{$new=$(`<table class="${defaultProp.className}"></table>`).css(defaultProp.style).append($tr);$article=this.addPage().append($new)}h=DocTool.getContentHeight($article)}})}}__continueWork(){if(this.az.length!==0){let task=this.az.splice(0,1)[0];task.method.apply(this,task.argArray)}}__getPageHeightLimit(){let height=this.f===""?this.d.height:parseFloat(this.f),paddingTop=this.g===""?this.d.paddingTop:parseFloat(this.g),paddingBottom=this.i===""?this.d.paddingBottom:parseFloat(this.i);return height-paddingTop-paddingBottom}__getLastPage(){let $article=this.b.children("article:last-child");if($article.length===0)$article=this.addPage();return $article}__addText(obj,fn=()=>undefined){let $article=this.__getLastPage(),contentHeight=DocTool.getContentHeight($article),pageHeightLimit=this.__getPageHeightLimit(),className=obj.className,title=obj.title,text=obj.text,$new=title===undefined?$(`<div class="${className}">${DocTool.htmlEncode(text)}</div>`):$(`<div class="${className}"><span style="font-weight: bold;">${DocTool.htmlEncode(title)}</span><span>${DocTool.htmlEncode(text)}</span></div>`);fn($new);$article.append($new);let h=contentHeight+$new.outerHeight();if(h>pageHeightLimit){$new.remove();let i=0;let $temp=$(`<div class="${className}">&nbsp;</div>`);$article.append($temp);if(contentHeight+$temp.outerHeight()<=pageHeightLimit){$temp.remove();while(h>pageHeightLimit&&i<text.length+(title===undefined?0:title.length)){$new.remove();if(title===undefined){let str=text.substring(0,text.length-(++i));$new=$(`<div class="${className}">${DocTool.htmlEncode(str)}</div>`)}else if(i<text.length){let str=text.substring(0,text.length-(++i));$new=$(`<div class="${className}"><span style="font-weight: bold;">${DocTool.htmlEncode(title)}</span><span>${DocTool.htmlEncode(str)}</span></div>`)}else{let str=title.substring(0,title.length+text.length-(++i));$new=$(`<div class="${className}"><span style="font-weight: bold;">${DocTool.htmlEncode(str)}</span></div>`)}fn($new);$article.append($new);h=contentHeight+$new.outerHeight()}this.addPage();if(title===undefined){obj.fn.call(this,text.substring(text.length-i))}else if(i<text.length){obj.fn.call(this,title,text.substring(text.length-i))}else{obj.fn.call(this,title.substring(title.length+text.length-i),text)}}else{$temp.remove();this.addPage();if(title===undefined){obj.fn.call(this,text)}else{obj.fn.call(this,title,text)}}}}static getContentHeight(a){let h=0;a.children().each(function(){if($(this).css("float")==="none")h+=$(this).outerHeight()});return h}static htmlEncode(a){let temp=document.createElement("div");(temp.textContent!==undefined)?(temp.textContent=a):(temp.innerText=a);let output=temp.innerHTML;temp=null;return output}static htmlDecode(a){let temp=document.createElement("div");temp.innerHTML=a;let output=temp.innerText||temp.textContent;temp=null;return output}static deleteProperties(a,b){for(let c in a){if(a.hasOwnProperty(c)&&c.includes(b)){delete a[c]}}}static shallowCopy(a,b){for(let c in b){if(a.hasOwnProperty(c)&&b.hasOwnProperty(c)){a[c]=b[c]}}}}